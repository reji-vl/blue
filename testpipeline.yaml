pool:
  name: Azure Pipelines
steps:
- task: CopyFiles@2
  displayName: 'Copy Files to: $(Build.ArtifactStagingDirectory)'
  inputs:
    Contents: '**.tf'
    TargetFolder: '$(Build.ArtifactStagingDirectory)'

- task: PublishBuildArtifacts@1
  displayName: 'Publish Artifact: drop'
  
steps:
- task: petergroenewegen.PeterGroenewegen-Xpirit-Vsts-Release-Terraform.Xpirit-Vsts-Release-Terraform.Terraform@2
  displayName: 'Terraform init'
  inputs:
    TemplatePath: '$(System.DefaultWorkingDirectory)/_custorder/drop'
    Arguments: init
    InstallTerraform: true
    Version: 0.12.21
    UseAzureSub: true
    ConnectedServiceNameARM: 'Free Trial (ab833764-bdf6-4d19-af30-0af2a16fd669)'
    
steps:
- task: petergroenewegen.PeterGroenewegen-Xpirit-Vsts-Release-Terraform.Xpirit-Vsts-Release-Terraform.Terraform@2
  displayName: 'Terraform plan'
  inputs:
    TemplatePath: '$(System.DefaultWorkingDirectory)/_custorder/drop'
    Arguments: plan
    InstallTerraform: true
    Version: 0.12.21
    UseAzureSub: true
    ConnectedServiceNameARM: 'Free Trial (ab833764-bdf6-4d19-af30-0af2a16fd669)'
    

steps:
- task: petergroenewegen.PeterGroenewegen-Xpirit-Vsts-Release-Terraform.Xpirit-Vsts-Release-Terraform.Terraform@2
  displayName: 'Terraform apply'
  inputs:
    TemplatePath: '$(System.DefaultWorkingDirectory)/_custorder/drop'
    Arguments: 'apply -auto-approve'
    InstallTerraform: true
    Version: 0.12.21
    UseAzureSub: true
    ConnectedServiceNameARM: 'Free Trial (ab833764-bdf6-4d19-af30-0af2a16fd669)'
